<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pulso-AI Dashboard | Telef√≥nica Per√∫</title>
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>üìä</text></svg>">
    
    <!-- CSS Styles -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 48px rgba(0,0,0,0.15);
        }
        
        .card h3 {
            color: #2563eb;
            margin-bottom: 16px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            color: #1e293b;
            margin-bottom: 8px;
        }
        
        .metric-label {
            color: #64748b;
            font-size: 0.9rem;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-online { background-color: #10b981; }
        .status-warning { background-color: #f59e0b; }
        .status-error { background-color: #ef4444; }
        
        .table-card {
            grid-column: 1 / -1;
        }
        
        .table-container {
            overflow-x: auto;
            margin-top: 16px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            text-align: left;
            padding: 12px;
            border-bottom: 1px solid #e5e7eb;
        }
        
        th {
            background-color: #f8fafc;
            font-weight: 600;
            color: #374151;
        }
        
        tr:hover {
            background-color: #f8fafc;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #64748b;
        }
        
        .error {
            background-color: #fef2f2;
            border: 1px solid #fecaca;
            color: #991b1b;
            padding: 16px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .refresh-btn {
            background: #2563eb;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.2s;
        }
        
        .refresh-btn:hover {
            background: #1d4ed8;
        }
        
        .footer {
            text-align: center;
            color: white;
            margin-top: 40px;
            opacity: 0.8;
        }
        
        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üìä Pulso-AI Dashboard</h1>
            <p>Telef√≥nica del Per√∫ - Gesti√≥n de Cobranza</p>
        </div>
        
        <!-- Dashboard Grid -->
        <div class="dashboard-grid">
            <!-- System Status Card -->
            <div class="card">
                <h3>üîß Estado del Sistema</h3>
                <div class="metric-value" id="system-status">
                    <span class="status-indicator status-online"></span>
                    Operativo
                </div>
                <div class="metric-label">Todos los servicios funcionando</div>
                <button class="refresh-btn" onclick="checkSystemHealth()">Verificar</button>
            </div>
            
            <!-- Database Status Card -->
            <div class="card">
                <h3>üóÑÔ∏è Base de Datos</h3>
                <div class="metric-value" id="db-status">
                    <span class="status-indicator status-online"></span>
                    Conectada
                </div>
                <div class="metric-label">PostgreSQL Datamart</div>
            </div>
            
            <!-- ETL Status Card -->
            <div class="card">
                <h3>üîÑ Pipeline ETL</h3>
                <div class="metric-value" id="etl-status">
                    <span class="status-indicator status-warning"></span>
                    Configurado
                </div>
                <div class="metric-label">BigQuery ‚Üí PostgreSQL</div>
            </div>
            
            <!-- API Status Card -->
            <div class="card">
                <h3>üåê API GraphQL</h3>
                <div class="metric-value" id="api-status">
                    <span class="status-indicator status-online"></span>
                    Disponible
                </div>
                <div class="metric-label">Endpoint: /api/graphql</div>
                <button class="refresh-btn" onclick="testGraphQLAPI()">Probar API</button>
            </div>
            
            <!-- Quick Stats Table -->
            <div class="card table-card">
                <h3>üìã Configuraci√≥n Actual</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Componente</th>
                                <th>Estado</th>
                                <th>Configuraci√≥n</th>
                                <th>√öltima Actualizaci√≥n</th>
                            </tr>
                        </thead>
                        <tbody id="config-table">
                            <tr>
                                <td>üè¢ Cliente</td>
                                <td><span class="status-indicator status-online"></span>Activo</td>
                                <td>Telef√≥nica del Per√∫</td>
                                <td>Configurado</td>
                            </tr>
                            <tr>
                                <td>üìä Fuente de Datos</td>
                                <td><span class="status-indicator status-online"></span>Configurada</td>
                                <td>BigQuery - mibot-222814.BI_USA</td>
                                <td>8 tablas identificadas</td>
                            </tr>
                            <tr>
                                <td>üéØ Schema Dimensional</td>
                                <td><span class="status-indicator status-online"></span>Creado</td>
                                <td>PostgreSQL - telefonica schema</td>
                                <td>5 dimensiones, 2 facts</td>
                            </tr>
                            <tr>
                                <td>üîó API Endpoints</td>
                                <td><span class="status-indicator status-online"></span>Funcionando</td>
                                <td>GraphQL + REST</td>
                                <td>/health, /graphql</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Error Display -->
        <div id="error-container"></div>
        
        <!-- Footer -->
        <div class="footer">
            <p>Pulso-AI v1.0 | Issue #19 - MVP Pipeline ETL b√°sico | Tiempo objetivo: <6 horas</p>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // API Base URL
        const API_BASE = '/api';
        
        // Check system health
        async function checkSystemHealth() {
            try {
                showLoading('system-status');
                
                const response = await fetch(`${API_BASE}/health`);
                const isHealthy = response.ok;
                
                updateStatus('system-status', isHealthy ? 'Operativo' : 'Error', isHealthy ? 'online' : 'error');
                
                if (isHealthy) {
                    showSuccess('‚úÖ Sistema funcionando correctamente');
                } else {
                    showError('‚ùå Error en el sistema. Verificar logs.');
                }
            } catch (error) {
                updateStatus('system-status', 'Sin conexi√≥n', 'error');
                showError(`Error de conexi√≥n: ${error.message}`);
            }
        }
        
        // Test GraphQL API
        async function testGraphQLAPI() {
            try {
                showLoading('api-status');
                
                const query = `
                    query {
                        __schema {
                            types {
                                name
                            }
                        }
                    }
                `;
                
                const response = await fetch(`${API_BASE}/graphql`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ query })
                });
                
                const result = await response.json();
                const isWorking = !result.errors;
                
                updateStatus('api-status', isWorking ? 'Disponible' : 'Error', isWorking ? 'online' : 'error');
                
                if (isWorking) {
                    showSuccess('‚úÖ GraphQL API respondiendo correctamente');
                    console.log('GraphQL Schema types:', result.data.__schema.types.length);
                } else {
                    showError('‚ùå Error en GraphQL API', result.errors);
                }
            } catch (error) {
                updateStatus('api-status', 'Sin conexi√≥n', 'error');
                showError(`Error de conexi√≥n GraphQL: ${error.message}`);
            }
        }
        
        // Update status indicator
        function updateStatus(elementId, text, status) {
            const element = document.getElementById(elementId);
            const indicator = element.querySelector('.status-indicator');
            
            element.innerHTML = `<span class="status-indicator status-${status}"></span>${text}`;
        }
        
        // Show loading state
        function showLoading(elementId) {
            const element = document.getElementById(elementId);
            element.innerHTML = '<span class="status-indicator status-warning"></span>Verificando...';
        }
        
        // Show success message
        function showSuccess(message) {
            const container = document.getElementById('error-container');
            container.innerHTML = `
                <div style="background-color: #ecfdf5; border: 1px solid #10b981; color: #065f46; padding: 16px; border-radius: 8px; margin: 20px 0;">
                    ${message}
                </div>
            `;
            setTimeout(() => container.innerHTML = '', 3000);
        }
        
        // Show error message
        function showError(message, details = null) {
            const container = document.getElementById('error-container');
            const detailsStr = details ? `<br><small>${JSON.stringify(details, null, 2)}</small>` : '';
            container.innerHTML = `
                <div class="error">
                    ${message}${detailsStr}
                </div>
            `;
        }
        
        // Initialize dashboard
        function initDashboard() {
            console.log('üöÄ Pulso-AI Dashboard iniciado');
            console.log('üìã Issue #19: Pipeline ETL b√°sico funcional');
            
            // Auto-check system health on load
            setTimeout(checkSystemHealth, 1000);
        }
        
        // Run when page loads
        document.addEventListener('DOMContentLoaded', initDashboard);
        
        // Auto-refresh every 30 seconds
        setInterval(() => {
            console.log('üîÑ Auto-refresh del sistema...');
            checkSystemHealth();
        }, 30000);
    </script>
</body>
</html>